# ğŸš‚ Railway.app éƒ¨ç½²è¯¦ç»†æ•™ç¨‹

Railway.app æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„äº‘å¹³å°ï¼Œå¯ä»¥è®©ä½ åœ¨å‡ åˆ†é’Ÿå†…éƒ¨ç½²åº”ç”¨ç¨‹åºã€‚æœ¬æ•™ç¨‹å°†æ‰‹æŠŠæ‰‹æ•™ä½ å¦‚ä½•éƒ¨ç½²æˆ‘ä»¬çš„ Flutter è·‘æ­¥åº”ç”¨åç«¯ã€‚

## ğŸ“‹ å‡†å¤‡å·¥ä½œ

### 1. æ£€æŸ¥åç«¯ä»£ç çŠ¶æ€

```bash
# ç¡®ä¿ä½ åœ¨æ­£ç¡®çš„ç›®å½•
cd my_flutter_app

# æ£€æŸ¥åç«¯æ–‡ä»¶æ˜¯å¦å®Œæ•´
ls backend/
# åº”è¯¥çœ‹åˆ°ï¼šserver.js, package.json, prisma/, routes/ ç­‰

# æ£€æŸ¥ package.json çš„ scripts éƒ¨åˆ†
cat backend/package.json
```

### 2. ç¡®ä¿ä»£ç å·²æäº¤åˆ° GitHub

```bash
# æ·»åŠ æ‰€æœ‰æ–‡ä»¶åˆ° Git
git add .

# æäº¤ä»£ç 
git commit -m "å‡†å¤‡éƒ¨ç½²åˆ° Railway"

# æ¨é€åˆ° GitHub
git push origin main
```

---

## ğŸš€ æ­¥éª¤ 1ï¼šæ³¨å†Œ Railway è´¦å·

### 1.1 è®¿é—®ç½‘ç«™

- æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®ï¼š[https://railway.app](https://railway.app)

### 1.2 æ³¨å†Œè´¦å·

1. ç‚¹å‡»å³ä¸Šè§’ **"Login"** æŒ‰é’®
2. é€‰æ‹© **"Login with GitHub"**
3. å¦‚æœæ²¡æœ‰ GitHub è´¦å·ï¼Œå…ˆæ³¨å†Œä¸€ä¸ª
4. æˆæƒ Railway è®¿é—®ä½ çš„ GitHub è´¦å·

---

## ğŸ› ï¸ æ­¥éª¤ 2ï¼šåˆ›å»ºæ–°é¡¹ç›®

### 2.1 åˆ›å»ºé¡¹ç›®

1. ç™»å½•åï¼Œç‚¹å‡» **"New Project"**
2. é€‰æ‹© **"Deploy from GitHub repo"**
3. å¦‚æœè¿™æ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼Œéœ€è¦è¿æ¥ GitHubï¼š
   - ç‚¹å‡» **"Configure GitHub App"**
   - é€‰æ‹©è¦æˆæƒçš„ä»“åº“ï¼ˆå¯ä»¥é€‰æ‹©æ‰€æœ‰ä»“åº“æˆ–ç‰¹å®šä»“åº“ï¼‰
   - ç‚¹å‡» **"Install & Authorize"**

### 2.2 é€‰æ‹©ä»“åº“

1. åœ¨ä»“åº“åˆ—è¡¨ä¸­æ‰¾åˆ°ä½ çš„é¡¹ç›®
2. ç‚¹å‡» **"Deploy Now"**
3. Railway ä¼šè‡ªåŠ¨æ£€æµ‹åˆ°è¿™æ˜¯ä¸€ä¸ª Node.js é¡¹ç›®

### 2.3 é…ç½®æ ¹ç›®å½•

ç”±äºæˆ‘ä»¬çš„åç«¯ä»£ç åœ¨ `backend` å­ç›®å½•ä¸­ï¼š

1. åœ¨é¡¹ç›®è®¾ç½®ä¸­æ‰¾åˆ° **"Source"** æˆ– **"Settings"**
2. è®¾ç½® **Root Directory** ä¸º `backend`
3. æˆ–è€…åœ¨éƒ¨ç½²æ—¶æŒ‡å®šï¼š**"backend"**

---

## âš™ï¸ æ­¥éª¤ 3ï¼šé…ç½®ç¯å¢ƒå˜é‡

### 3.1 è¿›å…¥é¡¹ç›®è®¾ç½®

1. åœ¨ Railway é¡¹ç›®ä»ªè¡¨æ¿ä¸­
2. ç‚¹å‡»ä½ çš„æœåŠ¡åç§°
3. ç‚¹å‡» **"Settings"** æˆ– **"Variables"** æ ‡ç­¾

### 3.2 æ·»åŠ ç¯å¢ƒå˜é‡

ç‚¹å‡» **"New Variable"** å¹¶æ·»åŠ ä»¥ä¸‹å˜é‡ï¼š

```env
DATABASE_URL=file:./dev.db
JWT_SECRET=your-super-secret-jwt-key-for-production-change-this
JWT_EXPIRES_IN=7d
NODE_ENV=production
PORT=3000
FRONTEND_URL=*
```

**é‡è¦æç¤º**ï¼š

- `JWT_SECRET`: è¯·æ›´æ”¹ä¸ºä¸€ä¸ªå¼ºå¯†ç ï¼Œæ¯”å¦‚ï¼š`my-super-secret-running-app-jwt-key-2024`
- `FRONTEND_URL`: æš‚æ—¶è®¾ä¸º `*`ï¼Œåé¢å¯ä»¥æ›´æ”¹ä¸ºä½ çš„å‰ç«¯åŸŸå

### 3.3 ä¿å­˜é…ç½®

1. ç¡®ä¿æ‰€æœ‰å˜é‡éƒ½æ­£ç¡®è¾“å…¥
2. ç‚¹å‡» **"Save"** æˆ–å˜é‡ä¼šè‡ªåŠ¨ä¿å­˜

---

## ğŸ”§ æ­¥éª¤ 4ï¼šé…ç½®éƒ¨ç½²è®¾ç½®

### 4.1 æ„å»ºé…ç½®

Railway é€šå¸¸ä¼šè‡ªåŠ¨æ£€æµ‹ï¼Œä½†ä½ å¯ä»¥æ‰‹åŠ¨é…ç½®ï¼š

1. åœ¨é¡¹ç›®è®¾ç½®ä¸­æ‰¾åˆ° **"Build"** éƒ¨åˆ†
2. ç¡®ä¿ä»¥ä¸‹è®¾ç½®ï¼š
   ```
   Build Command: npm install
   Start Command: npm start
   ```

### 4.2 åˆ›å»º railway.toml (å¯é€‰)

åœ¨ä½ çš„ `backend` ç›®å½•ä¸­åˆ›å»º `railway.toml` æ–‡ä»¶ï¼š

```toml
[build]
builder = "NIXPACKS"

[deploy]
startCommand = "npm start"
healthcheckPath = "/health"
healthcheckTimeout = 300
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10
```

---

## ğŸš€ æ­¥éª¤ 5ï¼šéƒ¨ç½²åº”ç”¨

### 5.1 è§¦å‘éƒ¨ç½²

1. é…ç½®å®Œæˆåï¼ŒRailway ä¼šè‡ªåŠ¨å¼€å§‹éƒ¨ç½²
2. ä½ å¯ä»¥åœ¨ **"Deployments"** æ ‡ç­¾ä¸­çœ‹åˆ°éƒ¨ç½²è¿›åº¦
3. éƒ¨ç½²è¿‡ç¨‹é€šå¸¸éœ€è¦ 2-5 åˆ†é’Ÿ

### 5.2 æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—

1. ç‚¹å‡»æ­£åœ¨è¿›è¡Œçš„éƒ¨ç½²
2. å¯ä»¥çœ‹åˆ°å®æ—¶æ—¥å¿—è¾“å‡º
3. ç¡®ä¿æ²¡æœ‰é”™è¯¯ä¿¡æ¯

### 5.3 è·å–åº”ç”¨ URL

1. éƒ¨ç½²æˆåŠŸåï¼Œåœ¨é¡¹ç›®ä»ªè¡¨æ¿ä¸­
2. ç‚¹å‡» **"Settings"** â†’ **"Domains"**
3. ä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„ URLï¼š`https://your-app-name.up.railway.app`
4. è¿™å°±æ˜¯ä½ çš„åç«¯ API åœ°å€ï¼

---

## âœ… æ­¥éª¤ 6ï¼šæµ‹è¯•éƒ¨ç½²ç»“æœ

### 6.1 æµ‹è¯•å¥åº·æ£€æŸ¥ç«¯ç‚¹

```bash
# æ›¿æ¢ä¸ºä½ çš„å®é™… Railway URL
curl https://your-app-name.up.railway.app/health
```

æœŸæœ›çœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„å“åº”ï¼š

```json
{
  "status": "OK",
  "timestamp": "2024-06-20T12:00:00.000Z",
  "service": "è·‘æ­¥è¿½è¸ªå™¨åç«¯æœåŠ¡"
}
```

### 6.2 æµ‹è¯•æ³¨å†Œæ¥å£

```bash
curl -X POST https://your-app-name.up.railway.app/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "password": "123456",
    "username": "testuser"
  }'
```

### 6.3 æµ‹è¯•ç™»å½•æ¥å£

```bash
curl -X POST https://your-app-name.up.railway.app/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "password": "123456"
  }'
```

---

## ğŸ” æ­¥éª¤ 7ï¼šé…ç½®è‡ªå®šä¹‰åŸŸåï¼ˆå¯é€‰ï¼‰

### 7.1 æ·»åŠ è‡ªå®šä¹‰åŸŸå

1. åœ¨ Railway é¡¹ç›®ä¸­ï¼Œè¿›å…¥ **"Settings"** â†’ **"Domains"**
2. ç‚¹å‡» **"Custom Domain"**
3. è¾“å…¥ä½ çš„åŸŸåï¼Œå¦‚ï¼š`api.yourdomain.com`
4. Railway ä¼šæä¾› CNAME è®°å½•ä¿¡æ¯

### 7.2 é…ç½® DNS

åœ¨ä½ çš„åŸŸåç®¡ç†é¢æ¿ä¸­ï¼š

```
ç±»å‹: CNAME
åç§°: api
å€¼: your-app-name.up.railway.app
```

---

## ğŸ“Š æ­¥éª¤ 8ï¼šç›‘æ§å’Œç»´æŠ¤

### 8.1 æŸ¥çœ‹åº”ç”¨æŒ‡æ ‡

1. åœ¨ Railway ä»ªè¡¨æ¿ä¸­å¯ä»¥çœ‹åˆ°ï¼š
   - CPU ä½¿ç”¨ç‡
   - å†…å­˜ä½¿ç”¨é‡
   - ç½‘ç»œæµé‡
   - å“åº”æ—¶é—´

### 8.2 æŸ¥çœ‹æ—¥å¿—

1. ç‚¹å‡» **"Logs"** æ ‡ç­¾
2. å¯ä»¥çœ‹åˆ°åº”ç”¨çš„å®æ—¶æ—¥å¿—
3. ç”¨äºè°ƒè¯•é—®é¢˜

### 8.3 é‡æ–°éƒ¨ç½²

å½“ä½ çš„ä»£ç æœ‰æ›´æ–°æ—¶ï¼š

1. æ¨é€ä»£ç åˆ° GitHubï¼š`git push origin main`
2. Railway ä¼šè‡ªåŠ¨æ£€æµ‹åˆ°æ›´æ”¹å¹¶é‡æ–°éƒ¨ç½²
3. ä¹Ÿå¯ä»¥æ‰‹åŠ¨è§¦å‘éƒ¨ç½²ï¼šç‚¹å‡» **"Deploy Latest"**

---

## ğŸ›¡ï¸ å®‰å…¨é…ç½®

### 9.1 æ›´æ–° CORS è®¾ç½®

æ›´æ–°ä½ çš„åç«¯ `server.js` ä¸­çš„ CORS é…ç½®ï¼š

```javascript
app.use(
  cors({
    origin: [
      "https://your-frontend-domain.vercel.app",
      "http://localhost:8080",
      "https://localhost:8080",
    ],
    credentials: true,
  })
);
```

### 9.2 ç”Ÿäº§ç¯å¢ƒå¯†é’¥

ç¡®ä¿åœ¨ Railway ä¸­çš„ `JWT_SECRET` æ˜¯ä¸€ä¸ªå¼ºå¯†ç ï¼š

```bash
# ç”Ÿæˆä¸€ä¸ªéšæœºå¯†é’¥
openssl rand -base64 32
```

---

## ğŸ’° è´¹ç”¨è¯´æ˜

### Railway å…è´¹é¢åº¦

- **æ‰§è¡Œæ—¶é—´**ï¼šæ¯æœˆ 500 å°æ—¶
- **å†…å­˜**ï¼š512MB RAM
- **å­˜å‚¨**ï¼š1GB æŒä¹…åŒ–å­˜å‚¨
- **å¸¦å®½**ï¼š100GB æµé‡

### å‡çº§é€‰é¡¹

- **Pro Plan**: $5/æœˆï¼Œæ›´å¤šèµ„æºå’ŒåŠŸèƒ½
- **æŒ‰ä½¿ç”¨é‡è®¡è´¹**ï¼šè¶…å‡ºå…è´¹é¢åº¦åæŒ‰å®é™…ä½¿ç”¨ä»˜è´¹

---

## â— å¸¸è§é—®é¢˜è§£å†³

### é—®é¢˜ 1ï¼šéƒ¨ç½²å¤±è´¥

**å¯èƒ½åŸå› **ï¼š

- `package.json` ä¸­ç¼ºå°‘ `start` è„šæœ¬
- ç¯å¢ƒå˜é‡é…ç½®é”™è¯¯
- Node.js ç‰ˆæœ¬ä¸å…¼å®¹

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# æ£€æŸ¥ package.json
cat backend/package.json

# ç¡®ä¿æœ‰ start è„šæœ¬
"scripts": {
  "start": "node server.js",
  "dev": "nodemon server.js"
}
```

### é—®é¢˜ 2ï¼šæ•°æ®åº“è¿æ¥é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. ç¡®ä¿ `DATABASE_URL=file:./dev.db`
2. åœ¨éƒ¨ç½²åè¿è¡Œæ•°æ®åº“è¿ç§»ï¼š
   ```bash
   # åœ¨ Railway é¡¹ç›®è®¾ç½®ä¸­æ·»åŠ æ„å»ºå‘½ä»¤
   npx prisma db push
   ```

### é—®é¢˜ 3ï¼šAPI 404 é”™è¯¯

**æ£€æŸ¥**ï¼š

1. URL æ˜¯å¦æ­£ç¡®ï¼š`/api/auth/login` è€Œä¸æ˜¯ `/auth/login`
2. åç«¯è·¯ç”±é…ç½®æ˜¯å¦æ­£ç¡®
3. æœåŠ¡æ˜¯å¦æ­£å¸¸å¯åŠ¨

### é—®é¢˜ 4ï¼šCORS é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
æ›´æ–° `server.js` ä¸­çš„ CORS é…ç½®ï¼Œæ·»åŠ ä½ çš„å‰ç«¯åŸŸå

---

## ğŸ‰ å®Œæˆï¼

æ­å–œï¼ä½ å·²ç»æˆåŠŸå°†åç«¯éƒ¨ç½²åˆ° Railway.appã€‚ç°åœ¨ä½ æœ‰äº†ï¼š

âœ… **å…è´¹çš„åç«¯ API æœåŠ¡**  
âœ… **è‡ªåŠ¨ HTTPS è¯ä¹¦**  
âœ… **è‡ªåŠ¨ç¼©æ”¾**  
âœ… **ç›‘æ§å’Œæ—¥å¿—**  
âœ… **æŒç»­éƒ¨ç½²**ï¼ˆä»£ç æ›´æ–°è‡ªåŠ¨éƒ¨ç½²ï¼‰

### ä¸‹ä¸€æ­¥ï¼š

1. **æ›´æ–° Flutter åº”ç”¨é…ç½®**ï¼šå°† API URL æ”¹ä¸ºä½ çš„ Railway åŸŸå
2. **éƒ¨ç½²å‰ç«¯**ï¼šä½¿ç”¨ Vercel æˆ– Netlify éƒ¨ç½² Flutter Web ç‰ˆæœ¬
3. **æ„å»ºç§»åŠ¨ç«¯**ï¼šä½¿ç”¨æ–°çš„ API URL æ„å»º Android/iOS åº”ç”¨

**ä½ çš„ Railway åç«¯åœ°å€**ï¼š`https://your-app-name.up.railway.app`

ç°åœ¨å¯ä»¥å¼€å§‹æ„å»ºå’Œæµ‹è¯•ä½ çš„å®Œæ•´åº”ç”¨äº†ï¼ğŸš€
